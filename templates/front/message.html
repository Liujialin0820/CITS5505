{% extends 'front/front_base.html' %}

{% block title %}
Messages
{% endblock %}

{% block main_content %}
<link rel="stylesheet" href="{{ url_for('static', filename='front/css/message.css') }}">

<div class="chat-container">
  <!-- Header: Title and control buttons -->
  <div class="chat-header">
    <h2>Messages</h2>
    <div class="chat-controls">
      <!-- Display current chat target -->
      <span id="current-target">No user selected</span>
      <!-- Button to open the user selector popup -->
      <button id="select-user-btn">Select User</button>
    </div>
  </div>

  <!-- User selection popup -->
  <div id="user-selector" class="user-popup hidden">
    <div class="user-popup-inner">
      <h4>Select a user to chat</h4>
      <!-- User list will be dynamically populated -->
      <ul id="user-list"></ul>
      <!-- Button to close the popup -->
      <button id="close-user-popup">Close</button>
    </div>
  </div>

  <!-- Main chat message display area -->
  <div id="chat-box" class="chat-box"></div>

  <!-- Message sending form -->
  <form id="message-form" class="chat-form">
    <!-- Input field for message text -->
    <input id="message-input" type="text" placeholder="Type a message..." autocomplete="off" />
    <!-- Button to share the user's timetable -->
    <button type="button" id="share-timetable-btn">Share Timetable</button>
    <!-- Submit button to send the message -->
    <button type="submit">Send</button>
  </form>

  <!-- Hidden element to store the current user's ID from the backend -->
  <div id="current-user" data-user-id="{{ current_user_id }}" style="display: none;"></div>

  <!-- CSRF token for secure AJAX requests -->
  <meta name="csrf-token" content="{{ csrf_token() }}">

  <!-- JavaScript dependencies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="{{ url_for('static', filename='common/zlajax.js') }}"></script>
  <script src="{{ url_for('static', filename='front/js/message.js') }}"></script>
</div>
{% endblock %}
